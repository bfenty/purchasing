<html>
<head>
{{template "header"}}
</head>
<body>
  {{template "navigation" .}}
  {{$permission := .Permission.Role}}
  <br> 
  <!-- Message Box -->
  <div aria-live="polite" aria-atomic="true" class="position-relative">
    <div id="toastContainer" class="toast-container position-absolute top-0 end-0 p-3">
        <!-- Toasts will be added here dynamically -->
      </div>
  </div>
  <!-- Image Modal -->
        <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="imageModalLabel">Image Title</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <img class="w-100" id="modalImage" src="">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                      <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      Are you sure you want to delete the item with SKU: <span id="deleteItemSku"></span>?
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                      <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                  </div>
              </div>
          </div>
      </div>      
        <!-- Main Table -->
        <table class="table table-striped table-hover">
            <thead class="table-dark" style="position: sticky; top: 0; z-index: 1;">
                <tr>
                    <th></th>
                    <th scope="col">SKU</th>
                    <th scope="col">Manufacturer Part #</th>
                    <th scope="col">Product Option</th>
                    {{if eq $permission "admin"}}<th scope="col">Manufacturer</th>{{end}}
                    {{if eq $permission "admin"}}<th scope="col">Processing Request</th>{{end}}
                    <th scope="col">Unit</th>
                    {{if eq $permission "admin"}}<th scope="col">Unit Price</th>{{end}}
                    {{if eq $permission "admin"}}<th scope="col">Currency</th>{{end}}
                    {{if eq $permission "admin"}}<th scope="col">Order Qty</th>{{end}}
                    {{if eq $permission "admin"}}<th scope="col">Reorder</th>{{end}}
                    <th scope="col">Season</th>
                    <th scope="col">Inventory</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="productTableBody">
            </tbody>
        </table>

        <script>
          $(document).ready(function() {
              console.log("Document ready. Initializing table data fetch.");
            fetchAndUpdateTable();

              // Event handler for image clicks
              $(document).on('click', '.image-link', function() {
                  var standardUrl = $(this).data('standard-url');
                  var sku = $(this).data('sku');

                  $('#imageModalLabel').text(sku);
                  $('#modalImage').attr('src', standardUrl);
                  $('#imageModal').modal('show');
              });
          });
      </script>
      {{template "toast" .}}
      {{template "fetchmanufacturers" .}}
      {{template "updateTable" .}}
      {{template "searchProductRow" .}}
      {{template "tableProductRow" .}}
      {{template "btninsertProduct" .}}
      {{template "btnupdateProduct" .}}
      {{template "btnDelete" .}}
      {{template "btnSearch" .}}
      
  {{template "footer" .}}
</body>
</html>