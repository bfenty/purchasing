<html>
<head>
  {{template "header"}}
  <title>{{.Title}}</title>
  
</head>
<body>
  {{template "navigation" .}}
  {{$permission := .Permission.Role}}
  {{$admin := .Permission.Permissions.Admin}}
  {{$mgmt := .Permission.Permissions.Mgmt}}
  {{$layout := .Layout}}
  {{template "toastBox" .}}
  {{template "pageControls" .}}
  <div>
    <div id="message" class="alert"></div>

    <h1>{{.Title}} - {{with $layout}}{{if eq $layout "receiving"}}Receiving{{else if eq $layout "mgmt"}}Management{{else if eq $layout "dataentry"}}Data Entry{{else if eq $layout "full"}}Full{{end}}{{end}}</h1>
    <div class="row" id="userTable">
      <div class="col-sm-12">
        <div>
          <table class="table table-striped table-hover table-responsive-stack" id="sorttable">
            <!-- Header -->
            <thead class="table-dark" style="position: sticky; top: 0; z-index: 1;">
              <tr>
                <th scope="col">Request ID</th>
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "dataentry") (eq $layout "mgmt")}}<th scope="col">SKU</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "dataentry")}}<th scope="col">Description</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "dataentry")}}<th scope="col">Manufacturer Part</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "dataentry") (eq $layout "mgmt")}}<th scope="col">Pcs/Bag</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "dataentry")}}<th scope="col">Weight Out</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full")}}<th scope="col">Weight In</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full")}}<th scope="col">Difference</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full")}}<th scope="col">%</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "mgmt")}}<th scope="col">Units</th>{{end}}
                {{if or (eq $layout "receiving") (eq $layout "full") (eq $layout "mgmt")}}<th scope="col">Hours</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "mgmt")}}<th scope="col">Check Out</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "mgmt")}}<th scope="col">Check In</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "mgmt")}}<th scope="col">Sorter</th>{{end}}
                {{if or (eq $layout "full")}}<th scope="col">Status</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "dataentry")}}<th scope="col">Priority</th>{{end}}
                {{if or (eq $layout "full") (eq $layout "receiving") (eq $layout "dataentry") (eq $layout "mgmt")}}<th scope="col" class="btn-col"></th>{{end}}
                {{if or (eq $layout "full") (eq $layout "mgmt")}}<th scope="col" class="btn-col"></th>{{end}}
                {{if or (eq $layout "full") (eq $layout "receiving") (eq $layout "mgmt")}}<th scope="col" class="btn-col"></th>{{end}}
              </tr>
            </thead>
            <tbody id="contentTableBody">
            </tbody>
          </table>
          <br>
          <br>
        </div>
      </div>
    </div>
  </div>
  {{template "footer" .}}
  {{template "toast" .}}
  {{template "nedry" .}}
  {{template "updateSortTable" .}}
  {{template "spinner" .}}
  <script>
      // Setup Page Variables
      var currentPage = 1; // keep track of the current page
      var totalPages = 0; // total number of pages, you might get this from the server
      var limit = 100; // set page size limit
      $('#limitSelect').val(limit);
      var searchParams = {}; //set initial search parameters
      $(document).ready(function() {
          console.log("Document ready. Initializing table data fetch.")
          fetchAndUpdateTable(currentPage,limit, searchParams);

          // Event handler for image clicks
          $(document).on('click', '.image-link', function() {
              var standardUrl = $(this).data('standard-url');
              var sku = $(this).data('sku');

              $('#imageModalLabel').text(sku);
              $('#modalImage').attr('src', standardUrl);
              $('#imageModal').modal('show');
          });
      });
  </script>

    <!-- Modal Dialogue -->
      <div class="modal fade" id="archiveRequestModal" tabindex="-1" role="dialog" aria-labelledby="archiveRequestModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="archiveRequestModalLabel">Confirm Archive Request</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to archive this request?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-danger" id="confirmArchiveRequest">Archive Request</button>
            </div>
          </div>
        </div>
      </div>
</body>
</html>